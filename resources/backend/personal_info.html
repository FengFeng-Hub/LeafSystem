<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>列表页面</title>
    <style>
        .ls-container {
            color: inherit;
        }
        .ls-personal-info li {
            margin-bottom: -1px;
            padding: 10px 0px;
            list-style: none;
            border: 1px solid #e7eaec;
            border-left: 0;
            border-right: 0;
        }
        .ls-box-center {
            display: flex;justify-content: center;align-items: center;
        }
    </style>
</head>
<body>
<div class="ls-container">
    <a-button v-if="pageParams.backMenuParams" size="small"
              @click="QiankunUtil.toPage('/backend/systemManage/menu/index.html', {backParams: pageParams.backMenuParams})"
              style="margin-right: 10px;"><a-icon type="rollback"></a-icon> 返回</a-button>
    <a-row :gutter="16">
        <a-col :xl="8" :lg="24" style="margin-bottom: 10px">
            <a-card title="个人资料">
                <div class="ls-box-center" style="margin: 10px;">
                    <a-avatar :src="$ls.backendUser.showAvatar" style="width: 100px;height: 100px;"></a-avatar>
                </div>
                <div class="ls-box-center"><a-button type="link">修改头像</a-button></div>
                <ul class="ls-personal-info">
                    <li>
                        <b class="font-noraml">名称：</b>
                        <p class="pull-right">{{$ls.backendUser.name}}</p>
                    </li>
                    <li>
                        <b class="font-noraml">账号：</b>
                        <p class="pull-right">{{$ls.backendUser.account}}</p>
                    </li>
                    <li>
                        <b class="font-noraml">个性签名：</b>
                        <p class="pull-right">{{$ls.backendUser.personal_signature}}</p>
                    </li>
                    <li>
                        <b class="font-noraml">生日：</b>
                        <p class="pull-right">{{$ls.backendUser.birthday}}</p>
                    </li>
                    <li>
                        <b class="font-noraml">手机号：</b>
                        <p class="pull-right">{{$ls.backendUser.phone}}</p>
                    </li>
                    <li>
                        <b class="font-noraml">电子邮箱：</b>
                        <p class="pull-right">{{$ls.backendUser.email}}</p>
                    </li>
                    <li>
                        <b class="font-noraml">性别：</b>
                        <p class="pull-right">
                            <a-tag v-if="$ls.backendUser.sex == '1'" color="blue"><a-icon type="man"></a-icon></a-tag>
                            <a-tag v-else-if="$ls.backendUser.sex == '2'" color="red"><a-icon type="woman"></a-icon></a-tag>
                            <a-tag v-else color="gray">未知</a-tag>
                        </p>
                    </li>
                </ul>
            </a-card>
        </a-col>
        <a-col :xl="16" :lg="24">
            <a-card>
                <a-tabs defaultActiveKey="1">
                    <a-tab-pane tab="基本信息" key="1">
                        <a-form-model :model="formData" :rules="formDataRules" ref="form">
                            <a-form-model-item label="名称" prop="name" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-input v-model="formData.name"/>
                            </a-form-model-item>
                            <a-form-model-item label="个性签名" prop="personal_signature" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-textarea v-model="formData.personal_signature" :rows="4" :maxlength="200" placeholder="最多输入 200 个字符"/>
                            </a-form-model-item>
                            <a-form-model-item label="生日" prop="birthday" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-date-picker
                                        v-model="formData.birthday"
                                        format="yyyy年MM月DD日"
                                        value-format="yyyy-MM-DD"
                                        style="max-width: 200px;"
                                />
                            </a-form-model-item>
                            <a-form-model-item label="手机号" prop="phone" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-input v-model="formData.phone"/>
                            </a-form-model-item>
                            <a-form-model-item label="电子邮箱" prop="email" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-input v-model="formData.email"/>
                            </a-form-model-item>
                            <a-form-model-item label="性别" prop="sex" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-radio-group v-model="formData.sex">
                                    <a-radio-button value="1">男</a-radio-button>
                                    <a-radio-button value="2">女</a-radio-button>
                                    <a-radio-button value="3">未知</a-radio-button>
                                </a-radio-group>
                            </a-form-model-item>
                            <a-form-item :wrapper-col="{ span: 12, offset: 5 }">
                                <a-button type="primary" @click="savaForm">保存</a-button>
                            </a-form-item>
                        </a-form-model>
                    </a-tab-pane>
                    <a-tab-pane tab="修改密码" key="2">
                        <a-form-model :model="formData2" :rules="formDataRules2" ref="form2">
                            <a-form-model-item label="旧密码" prop="password" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-input v-model="formData2.password" type="password"/>
                            </a-form-model-item>
                            <a-form-model-item label="新密码" prop="new_password" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-input v-model="formData2.new_password" type="password"/>
                            </a-form-model-item>
                            <a-form-model-item label="确认密码" prop="new_password2" :label-col="{span: 3}" :wrapper-col="{span: 20}">
                                <a-input v-model="formData2.new_password2" type="password"/>
                            </a-form-model-item>
                            <a-form-item :wrapper-col="{ span: 12, offset: 5 }">
                                <a-button type="primary" @click="savaForm2">保存</a-button>
                            </a-form-item>
                        </a-form-model>
                    </a-tab-pane>
                </a-tabs>
            </a-card>
        </a-col>
    </a-row>
</div>
</body>
<script>
    function init(props, params) {
        let _this = null;

        new Vue({
            el: ".ls-container",
            data: {
                pageParams: params,
                // 表单数据
                formData: {
                    name: null,
                    personal_signature: null,
                    avatar: '',
                    birthday: null,
                    phone: null,
                    email: null,
                    sex: null
                },
                // 表单验证
                formDataRules: {
                    name: [
                        { required: true, message: '名称为必填项', trigger: 'change' },
                        { max: 50, message: '长度不能超过 50 个字符', trigger: 'change' }
                    ],
                    personal_signature: [
                        { max: 250, message: '长度不能超过 250 个字符', trigger: 'change' }
                    ],
                    phone: [
                        { max: 50, message: '长度不能超过 50 个字符', trigger: 'change' }
                    ],
                    email: [
                        { max: 150, message: '长度不能超过 150 个字符', trigger: 'change' }
                    ]
                },
                formData2: {
                    password: '',
                    new_password: '',
                    new_password2: ''
                },
                // 表单验证
                formDataRules2: {
                    password: [
                        { required: true, message: '请输入原密码', trigger: 'change' }
                    ],
                    new_password: [
                        { required: true, message: '请输入密码', trigger: 'change' },
                        { max: 50, message: '长度不能超过 50 个字符', trigger: 'change' }
                    ],
                    new_password2: [
                        {
                            required: true,
                            validator(rule, value, callback) {
                                if (value === '') {
                                    callback(new Error('请再次输入密码'));
                                } else if (value !== _this.formData2.new_password) {
                                    callback(new Error('两次密码不一致'));
                                } else {
                                    callback();
                                }
                            },
                            trigger: 'change'
                        }
                    ]
                },
            },
            created() {
                _this = this;

                this.formData = this.$ls.backendUser;
            },
            mounted() {},
            methods: {
                savaForm() {
                    this.$refs.form.validate(valid => {
                        if (valid) {
                            Ajax.post({
                                url: '/system/api/user/updatePersonal?UpdateType=BaseInfo',
                                param: this.formData,
                                success(result) {
                                    if(result.IsSuccess === '1') {
                                        _this.$message.success('操作成功');
                                    } else {
                                        _this.$message.error(result.Msg);
                                    }
                                }
                            });
                        } else {
                            this.$message.error('表单校验失败，请检查输入');
                        }
                    });
                },
                savaForm2() {
                    this.$refs.form2.validate(valid => {
                        if (valid) {
                            Ajax.post({
                                url: '/system/api/user/updatePersonal?UpdateType=Password',
                                param: this.formData2,
                                success(result) {
                                    if(result.IsSuccess === '1') {
                                        _this.$message.success('操作成功');
                                        top.location.replace('./login');
                                    } else {
                                        _this.$message.error(result.Msg);
                                    }
                                }
                            });
                        } else {
                            this.$message.error('表单校验失败，请检查输入');
                        }
                    });
                }
            }
        });
    }

    // 获取qiankun子应用生命周期
    QiankunUtil.getLifecycles({
        mount(props) {
            init(props, props.params);
        }
    });
</script>
</html>